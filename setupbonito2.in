#!/bin/bash
# $Id: setupbonito2.in,v 1.10 2006-02-06 08:37:42 pary Exp $

cgipath=$1
datapath=$2

if test -z "$cgipath" || test -z "$datapath"
then
    echo "Usage: setupbonito2 CGIPATH DATAPATH"
    exit
fi

datadir=$DESTDIR@datadir@
setupdirs='@setupdirs@'
setupfiles='@setupfiles@'


for d in $cgipath $datapath $datapath/cache $datapath/subcorp $datapath/options
do
    test -d $DESTDIR$d || mkdir -p $DESTDIR$d
done

for d in $setupdirs; do
    mkdir -p $DESTDIR$cgipath/$d
done

for f in $setupfiles; do
    cp $datadir/$f $DESTDIR$cgipath/$f
done

if test -f $DESTDIR$cgipath/run.cgi
then
    echo "Preserving existing '$DESTDIR$cgipath/run.cgi' file."
else
    sed -e "s,@MANATEE_REGISTRY\@,$MANATEE_REGISTRY,g" \
	-e "s,@datapath\@,$datapath,g" $datadir/run.cgi > $DESTDIR$cgipath/run.cgi
    chmod +x $DESTDIR$cgipath/run.cgi
fi

touch $DESTDIR$datapath/htpasswd

if test -f $DESTDIR$cgipath/.htaccess
then
    echo "Preserving existing '$DESTDIR$cgipath/.htaccess' file."
else
    cat >$DESTDIR$cgipath/.htaccess <<EOF
AuthType Basic
AuthName Bonito2
AuthUserFile $datapath/htpasswd
require valid-user
EOF
fi

echo "Make sure $datapath/ subdirs are writable for a webserver running $cgipath/run.cgi"
echo "Edit corpus list, default corpus and other global options in $cgipath/run.cgi "
echo "Change access options in $cgipath/.htaccess and/or add usernames to $datapath/htpasswd"
